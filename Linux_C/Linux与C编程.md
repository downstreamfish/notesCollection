Linux与C编程
===

### gcc的用法
#### 1. gcc选项

>  gcc [options][filenames]

| 选 项       |        选项描述 |
| ---         |       ---|
| -x language | 指定使用的语言(C/C++/汇编) |
| -c | 只对文件进行编译和汇编, 但不进行连接 |
| -s | 只对文件进行编译, 但不汇编和连接 |
| -E | 只对文件进行预处理, 但不编译汇编和连接 |
| -o [file1]file2 | 将文件file2编译成可执行文件file1 |
| -l library | 用来指定所使用的库文件 |
| -I directory | 为include文件的搜索指定目录 |
| -w   | 禁止警告信息   |
| -pedantic| 严格要求符合ANSI标准|
| -Wall  | 显示附加的警告信息   |
| -g     | 显示排错信息以便用于gdb  |
| -p     | 产生prof 所需要的信息   |
| -pg    | 产生gprof所使用的信息   |
| -O(O1) | 对编译出的代码进行优化  |
| -O2   | 进行比-O高一级别的优化  |
| -O3   | 产生更高级别的优化    |
| -v    | 显示gcc版本     |
| -m ***| 根据不同的微处理器进行优化 |
| -g[gdb3] | 产生调试符号|
>  注意: 调试符号的使用可能与优化不兼容,两者混用,可能导致调试的混乱和失败

####  2. C预处理器 CPP
C预处理器cpp是用来完成宏的求值、条件编译。以及其他一些需要把代码传递到编译器前的工作。通常所见的那些"#"号后面的语句由cpp来进行处理

#### 3. gdb符号调试器
> * 监视程序中变量的值的变化
> * 设置断点，使程序在指定的代码行上暂停执行，便于观察
> * 单步执行代码
> * 分析崩溃程序产生的core文件
1. gdb下的命令
	* l--显示源代码
	* start--开始调试
	* break [main]/[line_num]
	* s--step 跳入函数
	* p--print 打印的变量名/或者用 变量=表达式 赋值
	* display--显示一些变量的值,使用此命令后,每当程序运行到断点处就会显示该表达式的值
	* n--next,执行下一行
	* q--quit,退出调试 
	* continue/cont--继续执行到下个或(N-1)个断点
	* delete--删除断点, 需要编号
	* clear--清除给出行号的断点
	* bt--backtrace,用来打印stack frame(栈帧)指针.可以了解当前程序运行过程中函数之间的调用关系.
	* f--frame用来跳入帧栈的 f 栈编号
#### make
> GNU make 是一种自动生成和维护目标程序的工具,它是一个单独工作的程序,可以调用编译器、连接器、汇编器等，根据程序各个部分的修改情况重新编译并链接目标代码，保证目标代码的最新组成。

* cat -v-t-e Makefile--其中-v将Makefile文件中的每一个tab字元以^I的方式打印，而-e将每一行的末尾以$的样子打印出来
* touch--将文件的修改时间设置为执行touch命令的时间。常用来测试make

####  文件与I/O

* 在linux系统中，有关I/O的操作可以分为两类，它们是基于文件描述符的I/O操作和基于流的I/O操作。它们有着各自不同的特点和优势，有些情况下它们是可以相互替代的，有些情况下则不是。

* 基于文件描述符的I/O操作是通过文件描述符对一个文件执行I/O操作的。文件是一个十分重要的概念。通常保存在外存重点数据都是以文件的形式保存的，文件描述符则是用于描述被打开文件的索引值。通常情况都是通过文件描述符打开一个文件执行I/O操作。

* 文件--文件是具有名字的一组相关信息的集合，在linux系统中，文件的准确定义是不包含有任何其他结构的字符流。通俗地说，就是文件中的字符与字符之间除了同属于一个文件之外，不存在任何其他的关系。
* 文件类型：
	+ 普通文件：最常见的一类文件，特点是不包含有文件系统的结构信息。
		- 文本文件：以字符表示（如ASCII码），是以行为基本结构的信息存储方式。
		- 二进制文件：是按信息在内存中的格式表示的，需要使用相应的软件查看。
	+ 目录文件：用于存放文件名及相关信息的文件，是内核组织文件系统的基本节点。
		
	>  在linux中，目录文件是一种文件，但linux的目录文件和其他操作系统中的“目录”的概念不同，它是linux文				件的一种  

	+ 链接文件:是一种特殊文件，实际上是指向一个真实存在的文件的链接。
	+ 设备文件：是linux中最特殊的文件，利用他，linux系统可以十分方便的访问外部设备。linux系统为外部设备提供一种标准接口，将外部设备视为一种特殊的文件。用户可以像访问普通文件一样访问外部设备。通常设备文件位于/dev目录下。设备文件使用设备的主设备号和次设备号来指定某外部设备。主设备号用于说明设备类型，次设备号用于说明具体设备。例如，/dev/hda3，其中hd是主设备号，a3是次设备号。
		- 块设备文件：块设备文件是以固定长度的块访问数据的
		- 字符设备文件：字符设备文件是以指定字符访问数据的
	
	> 在设备文件中有一个及其特殊的文件/dev/null。所有放入这一设备的数据都将不再存在。可以将它看成是删除操作。

	+ 管道文件：也是一种很特殊的文件。主要用于不同进程间的信息传递。一个进程将需要传递的数据或信息写入管道的一端，另一个进程则从管道的另一端取得所需的数据或信息。通常管道是建立在高速缓存中的，采用先进先出的规定处理其中数据。含有有名管道和无名管道。
	
* 文件权限：读(r:4)、写(w:2)、执行(x:1) 

* 文件的相关信息：
	+ 文件的目录结构
	+ 索引节点
	+ 文件的数据

* 文件系统：
> 文件系统是指按一定规律组织起来的有序的文件组织结构。是构成系统中所有数据的基础。系统中的所有文件都是驻留在文件系统中某一特定的位置。linux系统提供的文件系统是树形的层次结构系统。所有文件最终都归结到跟目录“/”下。

* 基于文件描述符的I/O操作
	+ 文件描述符是一个整数，是用于描述被打开文件的索引值的。它指向该文件的相关信息记录表。
	+ 文件的创建、打开和关闭操作是I/O操作的第一步

* 基于流(stream)的I/O操作
	+ 在linux系统中，文件和设备都被看做是数据流。
	+ 对流进行的操作：
		1. 调用库函数fopen()打开一个流。返回一个FILE结构指针，同时有三个流会自动打开，分别是标准输入、标准输出和标准错误。
		2. 使打开流时返回的FILE指针来表示所要操作的流，调用相应的库函数实现所需要的I/O操作。
		3. 当对一个流的操作完成后，需要执行清空缓存区、保存数据等操作。然后调用fclose()关闭流。

		> 如果不关闭流，可能造成数据的丢失。
		> 和自动打开一样，标准输入、标准输出和标准错误是自动关闭的

#### 进程
* 进程--按现在通行的认识，进程是具有一定功能的程序关于一个数据集合的一次执行过程。对于一个特定的程序来说，它的每一个正在运行中的副本都有自己的进程，就是说，如果用户在一个程序的一次运行尚未结束时再次启动该程序，则有两个进程在运行这个程序。多个进程可以同时运行，各个进程之间相互隔开，除非不同进程之间需要数据交换，否则互不影响。
* 并发--用户在执行一个程序以完成一定的功能时，为了提高程序执行的效率，可以把一个程序设计成由若干个部分组成，由若干个进程同时执行，这就是所谓并发程序的概念。
* 进程的属性：
  + 进程标识符(PID): 当一个进程产生时，系统都会为他分配一个进程标识符PID，对任意一个时刻来说，每个进程PID都是唯一的。



#### 程序及指令的执行过程

* 程序和指令的关系：

  程序由一条条指令组成，指令按顺序存放在内存连续单元

* 程序的执行：周而复始地执行一条条指令、

  + 正常情况下，指令按其存放顺序执行。
  + 遇到需改变程序执行流程时，相应的转移指令（包括无条件转移指令、条件转移指令、调用指令和返回指令等）来改变程序执行流程

* 程序的执行流的控制

  + 将要执行的指令所在的存储单元的地址由程序计数器 PC 给出，通过改变 PC 的值来控制执行顺序。

* 指令周期： CPU 取出并执行一条指令的时间

  CPI (Cycles Per Instruction)